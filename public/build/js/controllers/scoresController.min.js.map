{"version":3,"sources":["scoresController.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"scoresController.min.js","sourcesContent":["angular.module('myapp')\n.controller('ScoresController', ['$rootScope', '$state', '$stateParams', 'Restangular', '$modal', 'exam', '$http',\nfunction ($rootScope, $state, $stateParams, Restangular, $modal, exam, $http) {\n    var vm = this;\n    var base = exam.all('scores');\n\n    vm.exam = exam;\n    vm.msg = '載入中....';\n\n    // default th\n    var thStyle = {\"text-align\": 'right'};\n    var header = [\n        { \"key\": \"num\", \"name\": \"座號\", \"style\": {\"text-align\": 'center'} },\n        { \"key\": \"name\", \"name\": \"姓名\", \"style\": {\"text-align\": 'center'} },\n        { \"key\": \"chinese\", \"name\": \"國文\", \"style\": thStyle },\n        { \"key\": \"english\", \"name\": \"英文\", \"style\": thStyle },\n        { \"key\": \"math\", \"name\": \"數學\", \"style\": thStyle },\n        { \"key\": \"science\", \"name\": \"自然\", \"style\": thStyle },\n        { \"key\": \"social\", \"name\": \"社會\", \"style\": thStyle },\n        { \"key\": \"avg\", \"name\": \"平均\", \"style\": thStyle },\n        { \"key\": \"total\", \"name\": \"總分\", \"style\": thStyle },\n        { \"key\": \"rank\", \"name\": \"名次\", \"style\": thStyle },\n    ];\n\n    // 如果社會不是合科（也就是分科顯示）\n    // 加入分科之th\n    if(!vm.exam.social_merge){\n        header.splice(7, 0,\n            { \"key\": \"history\", \"name\": \"歷史\", \"style\": thStyle },\n            { \"key\": \"geo\", \"name\": \"地理\", \"style\": thStyle },\n            { \"key\": \"civic\", \"name\": \"公民\", \"style\": thStyle }\n        );\n    }\n\n    vm.tasty = {\n        // 不用來排序之欄位th key\n        // 空陣列表示都不排序\n        notSortBy: [],\n        // 表格資料\n        resource: {\n            \"header\": header,\n            \"rows\": [],\n            //\"sortBy\": \"\",\n            \"sortOrder\": \"asc\" // asc遞增，dsc遞減\n        }\n    };\n    // 表格資料\n    //vm.resource = {\n    //    \"header\": header,\n    //    \"rows\": [],\n    //    \"sortBy\": \"num\",\n    //    \"sortOrder\": \"asc\" // asc遞增，dsc遞減\n    //};\n\n    base.getList().then(\n        function(data){\n            vm.msg = (data.length > 0) ? '':'請匯入成績';\n            vm.tasty.resource.rows = data;\n        }\n    );\n\n    vm.showImportModal = function(){\n        var modalInstance = $modal.open({\n            templateUrl: 'partials/modals/importScores.html',\n            controller: 'ImportScoreModalInstanceCtrl',\n            controllerAs: 'ImportScoreModalCtrl',\n            size: 'lg',\n            resolve:{\n                tasty: function(){\n                    return angular.copy(vm.tasty);\n                },\n                title: function(){\n                    return \"(\" + vm.exam.grade + vm.exam.half + \") \" + vm.exam.name;\n                }\n            }\n        });\n\n        modalInstance.result\n            .then(function (data) {\n                vm.msg = '資料處理中....';\n                base.post(data).then(function(response){\n                    vm.msg = '';\n                    vm.tasty.resource.rows = base.getList().$object;\n                });\n            }, function () {\n                console.info('Import Modal dismissed at: ' + new Date());\n            });\n    };\n\n    vm.showAllScoresForStu =function(id){\n        var modalInstance = $modal.open({\n            templateUrl: 'partials/modals/showAllScoresForStu.html',\n            controller: 'ShowAllScoresForStuModalInstanceCtrl',\n            controllerAs: 'ModalCtrl',\n            size: 'lg',\n            resolve:{\n                data: function(){\n                    return $http.get('query-scores/' + id).then(\n                        function(response){\n                            return response.data;\n                        }\n                    );\n                }\n            }\n        });\n    };\n\n}])\n\n.controller('ImportScoreModalInstanceCtrl', ['$modalInstance','XLSXReaderService', 'tasty', 'title', function ($modalInstance, XLSXReaderService, tasty, title) {\n    var vm = this;\n\n    vm.showPreview = false; //以表格預覽\n    vm.showJSONPreview = true; //以json預覽\n    vm.items = [];//存放結果物件之陣列，一列為一個物件，key為欄名\n    vm.sheets = [];\n    vm.tasty = tasty;\n    vm.title = title;\n\n    //選擇檔案或選擇另一個檔案\n    //取得工作表 array\n    vm.fileChanged = function(files) {\n        vm.isProcessing = true; //處理中之 flag\n        vm.msg = \"讀取中....\";\n        vm.sheets = []; //工作表 array\n        vm.excelFile = files[0];//選擇之excel檔(.xlsx格式)\n\n        XLSXReaderService.readFile(vm.excelFile, vm.showPreview, vm.showJSONPreview)\n            .then(function (xlsxData) {\n                vm.sheets = xlsxData.sheets;\n                vm.isProcessing = false;\n                vm.msg = '';\n            });\n\n    };\n\n    // 選擇工作表時更新結果物件陣列\n    vm.updateItems = function() {\n        vm.items = vm.sheets[vm.selectedSheetName];\n        vm.tasty.resource.rows = vm.items;\n    }\n\n    vm.ok = function () {\n        $modalInstance.close(vm.items);\n    };\n\n    vm.cancel = function () {\n        $modalInstance.dismiss('cancel');\n    };\n}])\n\n.controller('ShowAllScoresForStuModalInstanceCtrl', ['$modalInstance', 'data', function ($modalInstance, data) {\n    var vm = this;\n    vm.data = data;\n    vm.cancel = function () {\n        $modalInstance.dismiss();\n    };\n}]);"],"sourceRoot":"/source/"}