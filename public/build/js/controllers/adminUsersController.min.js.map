{"version":3,"sources":["adminUsersController.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"adminUsersController.min.js","sourcesContent":["angular.module('myapp')\n.controller('AdminUsersController',['$rootScope', 'Restangular', 'lodash',\nfunction($rootScope, Restangular, lodash){\n    var vm = this;\n\n    //　參考資料：\n    //　http://zizzamia.com/ng-tasty/directive/table-server-side/complete\n    // pagination 初始化\n    vm.init = {\n        'count': 10, // 一頁幾筆\n        'page': 1, // 目前頁數\n        'sortBy': 'name', // 排序欄位\n        'sortOrder': 'asc' // 遞增 asc 或遞減 dsc(不是desc)\n    };\n\n    // 搜尋條件物件，預設列出 admin teacher\n    vm.filterBy = {\n        roles: {\n            admin: true,\n            teacher: true,\n            parents: false\n        }\n    };\n    // filter 改變時執行\n    //vm.search = function(params){\n    //    console.log(vm.filterBy);\n    //    console.log(params);\n    //};\n\n    // 取得分頁資料\n    // 參考資料 http://zizzamia.com/ng-tasty/directive/table-server-side/complete\n    vm.getResource = function (params, paramsObj) {\n        paramsObj.filterBy = vm.filterBy;\n        //console.log(params);\n        return Restangular.one('users/page', paramsObj.page).get(paramsObj).then(\n            function(pageData){\n                //console.log(pageData);\n\n                return {\n                    'rows': pageData.data, // 分頁表格內容\n                    'header': [ // 要當作分頁表格 thead 的資料欄位 key ，name 為顯示之文字\n                        //{ \"key\": \"id\", \"name\": \"ID\" },\n                        { \"key\": \"name\", \"name\": \"帳號\" },\n                        { \"key\": \"real_name\", \"name\": \"真實姓名\" },\n                        { \"key\": \"email\", \"name\": \"Email\" },\n                        { \"key\": \"roles\", \"name\": \"角色\" }\n                    ],\n                    'pagination':  {\n                        \"count\": pageData.per_page, // 一頁筆數\n                        \"page\": pageData.current_page, // 當前頁數\n                        \"pages\": pageData.last_page, // 總頁數\n                        \"size\": pageData.total // 資料總筆數\n                    },\n                    'sortBy': 'real_name', // 排序欄位\n                    'sortOrder': 'asc' // 遞增或遞減\n                };\n\n            },\n            function(error){\n                console.log(error);\n            });\n    };\n\n    // pagination 樣板檔路徑\n    // 參考資料 https://github.com/Zizzamia/ng-tasty/issues/86\n    vm.paginationTemplate = 'partials/pagination.html';\n\n    // 檢查 user 是否具有某種角色\n    // checkRole ==> 要檢查的 role name，admin、teacher、parents\n    // userRoles ==> 物件陣列，例如：\n    //          [\n    //              {id: \"1\", name: \"admin\", pivot: {user_id: \"1\", role_id: \"1\"}},\n    //              {id: \"2\", name: \"teacher\", pivot: {user_id: \"1\", role_id: \"2\"}}\n    //          ]\n    vm.checkPermission = function( checkRole, userRoles ){\n\n        // 用 lodash 取出 user 具備的 role name array\n        //　roles ==> ['admin', 'teacher']\n        var roles = lodash.map(userRoles, 'name');\n\n        return roles.indexOf(checkRole) !== -1;\n    };\n\n    // 變更角色設定\n    vm.togglePermission = function(userID, roleName){\n        Restangular.one('users', userID).put({mode: 'toggle_role', roleName: roleName}, {ignoreLoadingBar: true});\n    }\n\n\n}]);"],"sourceRoot":"/source/"}